<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Project PISA - Phase 1: Data Wrangling</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../Images/icon.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="../site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="../site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">

<script src="../site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="../site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="../site_libs/datatables-binding-0.31/datatables.js"></script>
<script src="../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="../site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="../site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="../site_libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="../site_libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
<link href="../site_libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="../site_libs/selectize-0.12.0/selectize.min.js"></script>
<link href="../site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="../site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../Images/Logo.png" alt="" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html" rel="" target="">
 <span class="menu-text">Team</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../proposal/proposal.html" rel="" target="">
 <span class="menu-text">Proposal</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-discovery" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Discovery</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-discovery">    
        <li>
    <a class="dropdown-item" href="../phase1/datawrangling.html" rel="" target="">
 <span class="dropdown-text">Data Wrangling</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../phase1/prototype.html" rel="" target="">
 <span class="dropdown-text">Prototype</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-shiny-app" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Shiny App</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-shiny-app">    
        <li>
    <a class="dropdown-item" href="../shinyapp/userguide.html" rel="" target="">
 <span class="dropdown-text">User Guide</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../shinyapp/shinyapp.html" rel="" target="">
 <span class="dropdown-text">Shiny App</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../poster/poster.html" rel="" target="">
 <span class="menu-text">Project Poster</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Phase 1: Data Wrangling</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#pisa-data" id="toc-pisa-data" class="nav-link active" data-scroll-target="#pisa-data">1 PISA Data</a></li>
  <li><a href="#getting-started" id="toc-getting-started" class="nav-link" data-scroll-target="#getting-started">2 Getting Started</a></li>
  <li><a href="#reading-data-into-r" id="toc-reading-data-into-r" class="nav-link" data-scroll-target="#reading-data-into-r">3 Reading Data into R</a>
  <ul class="collapse">
  <li><a href="#importing-sas-file" id="toc-importing-sas-file" class="nav-link" data-scroll-target="#importing-sas-file">3.1 Importing sas file</a></li>
  <li><a href="#importing-txt-file-with-dictionary" id="toc-importing-txt-file-with-dictionary" class="nav-link" data-scroll-target="#importing-txt-file-with-dictionary">3.2 Importing txt file with dictionary</a></li>
  </ul></li>
  <li><a href="#data-wrangling" id="toc-data-wrangling" class="nav-link" data-scroll-target="#data-wrangling">4 Data Wrangling</a>
  <ul class="collapse">
  <li><a href="#filtering-for-required-dataset" id="toc-filtering-for-required-dataset" class="nav-link" data-scroll-target="#filtering-for-required-dataset">4.1 Filtering for required dataset</a>
  <ul class="collapse">
  <li><a href="#the-longitudinal-data" id="toc-the-longitudinal-data" class="nav-link" data-scroll-target="#the-longitudinal-data">4.1.1 The Longitudinal Data</a></li>
  <li><a href="#the-2022-students-questionnaire-data" id="toc-the-2022-students-questionnaire-data" class="nav-link" data-scroll-target="#the-2022-students-questionnaire-data">4.1.2 The 2022 Student’s Questionnaire data</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#data-health" id="toc-data-health" class="nav-link" data-scroll-target="#data-health">Data Health</a>
  <ul class="collapse">
  <li><a href="#duplicates-check" id="toc-duplicates-check" class="nav-link" data-scroll-target="#duplicates-check">Duplicates Check</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="pisa-data" class="level1">
<h1>1 PISA Data</h1>
<p>The PISA Data from 2000 to 2022 are available on the <a href="https://www.oecd.org/pisa/data/">OECD website</a>.</p>
</section>
<section id="getting-started" class="level1">
<h1>2 Getting Started</h1>
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 80%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Library</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="https://www.tidyverse.org/"><strong>tidyverse</strong></a></td>
<td>A collection of core packages designed for data science, used extensively for data preparation and wrangling.</td>
</tr>
<tr class="even">
<td><a href="https://haven.tidyverse.org/"><strong>haven</strong></a></td>
<td>To enable R to read and write various data formats such as SAS and SPSS.</td>
</tr>
<tr class="odd">
<td><a href="https://yihui.org/knitr/"><strong>knitr</strong></a></td>
<td>For dynamic report generation.</td>
</tr>
</tbody>
</table>
<p>The following code chunk uses <code>p_load()</code> of <a href="https://rpubs.com/akshaypatankar/594834"><strong>pacman</strong></a> package to check if tidyverse packages are installed in the computer. If they are, the libraries will be called into R.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse, haven, knitr, </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>               sjlabelled,</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>               gt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="reading-data-into-r" class="level1">
<h1>3 Reading Data into R</h1>
<p>The next two sections cover the steps taken to read in the raw data.</p>
<section id="importing-sas-file" class="level2">
<h2 class="anchored" data-anchor-id="importing-sas-file">3.1 Importing sas file</h2>
<p>From PISA 2015 and its later cycles, SAS data sets (<code>.sas</code>) are available with all countries in the file for each respondent type.</p>
<p>The code chunk below imports the <em>2015, 2018, 2022 Student Questionnaire</em> dataset downloaded from OECD’s PISA Database using the following functions:</p>
<ul>
<li><p><code>list.files()</code> to identify all SAS files in the data directory and stores their paths in <em>filename</em> variable</p></li>
<li><p><code>for (i in 1:length(filenames))</code> iterates over each file identified, and:</p>
<ul>
<li><p><code>read_sas()</code> function of the <a href="https://haven.tidyverse.org/"><strong>haven</strong></a> package to import each file into the R environment,</p></li>
<li><p><code>sub()</code> to extract parts of the file name,</p></li>
<li><p><code>assign()</code> assigns extracted partial file name to the data that was read,</p></li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># List of all SAS files in directory</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>filenames <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="st">"data/"</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">pattern =</span> <span class="st">"*.sas7bdat"</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">full.names =</span> T)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(filenames))</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  name <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"^.*?/(.*?)(</span><span class="sc">\\</span><span class="st">.sas7bdat)$"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, filenames[i])</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">read_sas</span>(filenames[i])</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span> (name, data)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="importing-txt-file-with-dictionary" class="level2">
<h2 class="anchored" data-anchor-id="importing-txt-file-with-dictionary">3.2 Importing txt file with dictionary</h2>
<p>PISA 2012 and its earlier cycles’ data are provided in 2 forms – a fixed width (or ASCII) text format (<code>.txt</code>), and the corresponding SAS import control syntax file (<code>.sas</code>) for reading the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading the dictionary</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>dict_student_2012 <span class="ot">=</span> SAScii<span class="sc">::</span><span class="fu">parse.SAScii</span>(<span class="at">sas_ri =</span> <span class="st">'data/PISA2012_SAS_student.sas'</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating the positions to read_fwf</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>stu_qqq_2012 <span class="ot">&lt;-</span> <span class="fu">read_fwf</span>(<span class="at">file =</span> <span class="st">'data/stu_qqq_2012.txt'</span>, <span class="at">col_positions =</span> <span class="fu">fwf_widths</span>(dict_student_2012<span class="sc">$</span>width), <span class="at">progress =</span> T)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Assigns column headers using dictionary</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(stu_qqq_2012) <span class="ot">&lt;-</span> dict_student_2012<span class="sc">$</span>varname</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Each dataset is a tibble dataframe, containing observations (rows) across variables (columns). Each observation corresponds to an entry from a student who participated in the PISA survey for students in the respective years, and the variables correspond to information from students on various aspects of their home, family, and school background.</p>
</section>
</section>
<section id="data-wrangling" class="level1">
<h1>4 Data Wrangling</h1>
<div class="cell" data-fig-width="8">
<div class="cell-output-display">
<div>
<div>
<pre class="mermaid mermaid-js">flowchart TD

    A[PISA Survey] --&gt; A1[2022 Data Student Questionnaire] 

    A1 -.-&gt; A11(Gender)
    A1 -.-&gt; A12(Socio-economic)
    A1 -.-&gt; A13(Psychological Wellbeing)
    A1 -.-&gt; A14(Schools)  

    A1 -.-&gt; A2   
    A2[Combine 2012-2018]-.-&gt;A3(Longitudinal)

    

</pre>
</div>
</div>
</div>
</div>
<p>The data manipulation is performed in 2 parts:</p>
<ul>
<li><em>Longitudinal data:</em> To conduct longitudinal comparisons of PISA scores of Singapore students across different years.</li>
<li><em>Detailed 2022 Student’s Questionnaire data:</em> To compare the PISA scores between different groups of students based on factors such as gender, socioeconomic status (e.g., employment status of parents, immigrant status), and psychological well-being (e.g., feeling of loneliness, resilience when faced with challenges). On top of that, we aim to gain an understanding of the varying levels of importance and statistical significance of the various influences on PISA scores for different clusters of students.</li>
</ul>
<section id="filtering-for-required-dataset" class="level2">
<h2 class="anchored" data-anchor-id="filtering-for-required-dataset">4.1 Filtering for required dataset</h2>
<section id="the-longitudinal-data" class="level3">
<h3 class="anchored" data-anchor-id="the-longitudinal-data">4.1.1 The Longitudinal Data</h3>
<p>The helper function below is designed to extract and process data for longitudinal analysis of student scores in Math, Science and Reading. Let’s break down the function:</p>
<ol type="1">
<li><em>Object</em>: The expected argument <em>object</em> retrieves the name of object which the survey is stored in.</li>
<li><code>deparse(substitute(object))</code>: Returns the name of the object as a character string and stores this as a variable <em>filename</em>.</li>
<li><code>filter()</code>: Filters the dataset to only include responses from Singapore students.</li>
<li><code>matches()</code>: Select columns that starts with “PV” and contains either “MATH”, “SCIE”, or “READ” to extract the plausible values of scores related to the subjects of Mathematics, Science, and Reading.
<ol type="1">
<li><code>^PV</code>: Matches the beginning of the column name with “PV”.</li>
<li><code>.*?</code>: Matches any character (<code>.</code>) zero or more times (<code>*</code>), as few times as possible (<code>?</code>). This allows for any or no characters to appear between “PV” and the subject name.</li>
<li><code>(MATH|SCIE|READ)</code>: Is a group containing three alternative subjects to be matched, separated by <code>|</code>.</li>
<li><code>$</code>: Matches the end of the column name.</li>
</ol></li>
<li><code>mutate()</code>: Creates new columns to contain newly derived variables.
<ul>
<li><em>year</em>: Represent the responses it pertains to, extracted from the file name using <code>substr()</code>.</li>
<li><em>math</em>, <em>reading</em>, <em>science</em>: Calculates the mean plausible value for math, reading, and science scores for each student using <code>rowMeans()</code> applied across selected columns identified by `matches()``</li>
</ul></li>
<li><code>select()</code>: Retains the relevant columns for our analysis.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>long <span class="ot">&lt;-</span> <span class="cf">function</span>(object) {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  filename <span class="ot">&lt;-</span> <span class="fu">deparse</span>(<span class="fu">substitute</span>(object))</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> object <span class="sc">%&gt;%</span> </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"SGP"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">matches</span>(<span class="st">"^PV.*?(MATH|SCIE|READ)$"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">substr</span>(filename, <span class="dv">9</span>, <span class="dv">12</span>),</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">math =</span> <span class="fu">rowMeans</span>(<span class="fu">across</span>(<span class="fu">matches</span>(<span class="st">"^PV.*?(MATH)$"</span>)), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">reading =</span> <span class="fu">rowMeans</span>(<span class="fu">across</span>(<span class="fu">matches</span>(<span class="st">"^PV.*?(READ)$"</span>)), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">science =</span> <span class="fu">rowMeans</span>(<span class="fu">across</span>(<span class="fu">matches</span>(<span class="st">"^PV.*?(SCIE)$"</span>)), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>           ) <span class="sc">%&gt;%</span> </span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(year, math, reading, science)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s get the required data using the <code>long</code> function defined and combine all the results from various years together in 1 dataset named <em>stu_longitudinal</em> using <code>bind_rows()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>long_2012_SG <span class="ot">&lt;-</span> <span class="fu">long</span>(stu_qqq_2012)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>long_2015_SG <span class="ot">&lt;-</span> <span class="fu">long</span>(stu_qqq_2015)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>long_2018_SG <span class="ot">&lt;-</span> <span class="fu">long</span>(stu_qqq_2018)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>long_2022_SG <span class="ot">&lt;-</span> <span class="fu">long</span>(stu_qqq_2022)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>stu_longtitudinal <span class="ot">&lt;-</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">list</span>(long_2012_SG,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>                long_2015_SG,</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>                long_2018_SG,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>                long_2022_SG))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <em>.rds</em> file format is usually smaller than its SAS file counterpart and will therefore take up less storage space. The <em>.rds</em> file will also preserve data types and classes such as factors and dates eliminating the need to redefine data types after loading the file. For fast and space efficient data storage, files can be exported as RDS and re-imported into R using <a href="https://readr.tidyverse.org/reference/read_rds.html"><code>write_rds()</code></a> and <a href="https://readr.tidyverse.org/reference/read_rds.html"><code>read_rds()</code></a> respectively.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(stu_longtitudinal, <span class="st">"data/stu_longtitudinal.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>stu_longtitudinal <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/stu_longtitudinal.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s take a look at the first 10 rows of our longitudinal dataset.</p>
<div class="cell">
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item" id="htmlwidget-8db3f7a0923ee78f7581" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-8db3f7a0923ee78f7581">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td><\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\" disabled=\"\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"381.76506\" data-max=\"697.85792\" data-scale=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"420.67058\" data-max=\"686.44676\" data-scale=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"377.13538\" data-max=\"682.6184\" data-scale=\"5\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["1","2","3","4","5","6","7","8","9","10"],["2012","2012","2012","2012","2012","2012","2012","2012","2012","2012"],[544.7188,438.08226,685.62862,697.8579199999999,599.24442,381.76506,634.6860800000001,480.067,656.8858,571.43636],[531.9534200000001,447.91542,657.0573000000001,686.44676,571.82778,420.67058,633.5456799999999,531.5563,637.0406400000001,592.55926],[519.33982,377.13538,632.35734,682.6184,577.90004,386.83328,628.44088,462.73778,621.2607400000001,528.29168]],"container":"<table class=\"compact\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>year<\/th>\n      <th>math<\/th>\n      <th>reading<\/th>\n      <th>science<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"dom":"tip","columnDefs":[{"className":"dt-right","targets":[2,3,4]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"year","targets":1},{"name":"math","targets":2},{"name":"reading","targets":3},{"name":"science","targets":4}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="the-2022-students-questionnaire-data" class="level3">
<h3 class="anchored" data-anchor-id="the-2022-students-questionnaire-data">4.1.2 The 2022 Student’s Questionnaire data</h3>
<p>After perusing through the <a href="https://webfs.oecd.org/pisa2022/CY08MSP_CODEBOOK_5thDecember23.xlsx">Codebook</a> and <a href="https://www.oecd.org/pisa/data/pisa2022technicalreport/">Technical Report</a>, the team narrowed down the questions from the survey that would yield insightful results. The names of the columns are stored in a <em>.csv</em> file named <em>colname</em>.</p>
<p>To filter the raw dataset with the columns, we first import <em>colname</em> into R environment using <a href="https://readr.tidyverse.org/reference/read_delim.html"><code>read_csv()</code></a> function of <a href="https://readr.tidyverse.org/"><strong>readr</strong></a> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>colname <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/colname.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The following code chunk serves the following purpose: - <a href="https://dplyr.tidyverse.org/reference/filter.html"><code>filter()</code></a> of the <a href="https://dplyr.tidyverse.org/"><strong>dplyr</strong></a> package to extract Singapore responses, where <em>CNT = SGP</em>, for a more focused analysis, - <a href="https://dplyr.tidyverse.org/reference/select.html"><code>select()</code></a> function - To keep columns identified in <em>colname</em>, - Retain only variables with &lt;20% missing values -</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>stu_qqq_2022_SG <span class="ot">&lt;-</span> stu_qqq_2022 <span class="sc">%&gt;%</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter each dataset for CNT = "SGP"</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"SGP"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Retains desired variables</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(colname<span class="sc">$</span>colname) <span class="sc">%&gt;%</span> </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Retains variables with &lt;20% missing values</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">which</span>(<span class="fu">colSums</span>(<span class="fu">is.na</span>(.))<span class="sc">/</span><span class="fu">nrow</span>(.) <span class="sc">&lt;</span> <span class="fl">0.2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculates the mean of plausible values for each subject per student</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">math =</span> <span class="fu">rowMeans</span>(<span class="fu">across</span>(<span class="fu">matches</span>(<span class="st">"^PV.*?(MATH)$"</span>)), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">reading =</span> <span class="fu">rowMeans</span>(<span class="fu">across</span>(<span class="fu">matches</span>(<span class="st">"^PV.*?(READ)$"</span>)), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">science =</span> <span class="fu">rowMeans</span>(<span class="fu">across</span>(<span class="fu">matches</span>(<span class="st">"^PV.*?(SCIE)$"</span>)), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">%&gt;%</span> </span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Drops Plausible Values columns</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">matches</span>(<span class="st">"^PV.*?(MATH|SCIE|READ)$"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>stu_qqq_2022_SG</code> contains 6606 observations across 266 variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(stu_qqq_2022_SG, <span class="st">"data/stu_qqq_2022_SG.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>stu_qqq_2022_SG <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/stu_qqq_2022_SG.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Below are the retained variables and the Survey question it pertains to.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>labelled<span class="sc">::</span><span class="fu">generate_dictionary</span>(stu_qqq_2022_SG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> pos variable   label                                          col_type missing
 1   STRATUM    Stratum ID 5-character (cnt + original stratu~ chr      0      
 2   ST004D01T  Student (Standardized) Gender                  dbl      0      
 3   ST250Q01JA Which of the following are in your [home]: A ~ dbl      66     
 4   ST250Q02JA Which of the following are in your [home]: A ~ dbl      45     
 5   ST250Q03JA Which of the following are in your [home]: Ed~ dbl      60     
 6   ST250Q04JA Which of the following are in your [home]: Yo~ dbl      46     
 7   ST250Q05JA Which of the following are in your [home]: In~ dbl      46     
 8   ST250D06JA Which of the following are in your home? &lt;Cou~ chr      0      
 9   ST250D07JA Which of the following are in your home? &lt;Cou~ chr      0      
 10  ST251Q01JA How many of these items are there at your [ho~ dbl      47     
 11  ST251Q02JA How many of these items are there at your [ho~ dbl      78     
 12  ST251Q03JA How many of these items are there at your [ho~ dbl      51     
 13  ST251Q04JA How many of these items are there at your [ho~ dbl      62     
 14  ST251Q06JA How many of these items are there at your [ho~ dbl      47     
 15  ST251Q07JA How many of these items are there at your [ho~ dbl      42     
 16  ST253Q01JA How many [digital devices] with screens are t~ dbl      41     
 17  ST254Q01JA How many of the following [digital devices] a~ dbl      134    
 18  ST254Q02JA How many of the following [digital devices] a~ dbl      188    
 19  ST254Q03JA How many of the following [digital devices] a~ dbl      176    
 20  ST254Q04JA How many of the following [digital devices] a~ dbl      117    
 21  ST254Q05JA How many of the following [digital devices] a~ dbl      120    
 22  ST254Q06JA How many of the following [digital devices] a~ dbl      58     
 23  ST255Q01JA How many books are there in your [home]?       dbl      44     
 24  ST256Q01JA How many of these books at [home]: Religious ~ dbl      359    
 25  ST256Q02JA How many of these books at [home]: Classical ~ dbl      347    
 26  ST256Q03JA How many of these books at [home]: Contempora~ dbl      357    
 27  ST256Q06JA How many of these books at [home]: Books on s~ dbl      318    
 28  ST256Q07JA How many of these books at [home]: Books on a~ dbl      339    
 29  ST256Q08JA How many of these books at [home]: [Technical~ dbl      377    
 30  ST256Q09JA How many of these books at [home]: Dictionari~ dbl      299    
 31  ST256Q10JA How many of these books at [home]: Books to h~ dbl      278    
 32  ST230Q01JA How many siblings (including brothers, sister~ dbl      43     
 33  ST258Q01JA In the past 30 days, how often did you not ea~ dbl      46     
 34  ST019AQ01T In what country were you and your parents bor~ dbl      142    
 35  ST019BQ01T In what country were you and your parents bor~ dbl      64     
 36  ST019CQ01T In what country were you and your parents bor~ dbl      76     
 37  ST022Q01TA What language do you speak at home most of th~ dbl      42     
 38  ST226Q01JA How long have you been enrolled at this schoo~ dbl      46     
 39  ST125Q01NA How old were you when you started [ISCED 0]: ~ dbl      56     
 40  ST126Q01TA How old were you when you started [ISCED 1]: ~ dbl      52     
 41  ST127Q01TA Have you ever repeated a [grade]: At [ISCED 1] dbl      63     
 42  ST127Q02TA Have you ever repeated a [grade]: At [ISCED 2] dbl      75     
 43  ST127Q03TA Have you ever repeated a [grade]: At [ISCED 3] dbl      95     
 44  ST260Q01JA Have you ever missed school for more than thr~ dbl      59     
 45  ST260Q02JA Have you ever missed school for more than thr~ dbl      71     
 46  ST260Q03JA Have you ever missed school for more than thr~ dbl      80     
 47  ST062Q01TA In the last two full weeks of school, how oft~ dbl      60     
 48  ST062Q02TA In the last two full weeks of school, how oft~ dbl      59     
 49  ST062Q03TA In the last two full weeks of school, how oft~ dbl      49     
 50  ST034Q01TA Agree/disagree:  I feel like an outsider (or ~ dbl      1139   
 51  ST034Q02TA Agree/disagree:  I make friends easily at sch~ dbl      1087   
 52  ST034Q03TA Agree/disagree:  I feel like I belong at scho~ dbl      1164   
 53  ST034Q04TA Agree/disagree:  I feel awkward and out of pl~ dbl      1174   
 54  ST034Q05TA Agree/disagree:  Other students seem to like ~ dbl      1161   
 55  ST034Q06TA Agree/disagree:  I feel lonely at school.      dbl      1147   
 56  ST038Q03NA In past 12 months, how often: Other students ~ dbl      53     
 57  ST038Q04NA In past 12 months, how often: Other students ~ dbl      49     
 58  ST038Q05NA In past 12 months, how often: I was threatene~ dbl      60     
 59  ST038Q06NA In past 12 months, how often: Other students ~ dbl      50     
 60  ST038Q07NA In past 12 months, how often: I got hit or pu~ dbl      51     
 61  ST038Q08NA In past 12 months, how often: Other students ~ dbl      58     
 62  ST038Q09JA In past 12 months, how often: I was in a phys~ dbl      49     
 63  ST038Q10JA In past 12 months, how often: I stayed home f~ dbl      49     
 64  ST038Q11JA In past 12 months, how often: I gave money to~ dbl      47     
 65  ST265Q01JA Agree/disagree: I feel safe on my way to scho~ dbl      43     
 66  ST265Q02JA Agree/disagree: I feel safe on my way home fr~ dbl      46     
 67  ST265Q03JA Agree/disagree: I feel safe in my classrooms ~ dbl      44     
 68  ST265Q04JA Agree/disagree: I feel safe at other places a~ dbl      43     
 69  ST266Q01JA Occur during past four weeks:  Our school was~ dbl      52     
 70  ST266Q02JA Occur during past four weeks:  I witnessed a ~ dbl      51     
 71  ST266Q03JA Occur during past four weeks:  I saw gangs in~ dbl      53     
 72  ST266Q04JA Occur during past four weeks:  I heard a stud~ dbl      52     
 73  ST266Q05JA Occur during past four weeks:  I saw a studen~ dbl      53     
 74  ST294Q01JA How many days/wk before school: Eat breakfast  dbl      50     
 75  ST294Q02JA How many days/wk before school: Study for sch~ dbl      97     
 76  ST294Q03JA How many days/wk before school: Work in the h~ dbl      73     
 77  ST294Q04JA How many days/wk before school: Work for pay   dbl      58     
 78  ST294Q05JA How many days/wk before school: Exercise or p~ dbl      50     
 79  ST295Q01JA How many days/wk after school: Eat dinner      dbl      69     
 80  ST295Q02JA How many days/wk after school: Study for scho~ dbl      79     
 81  ST295Q03JA How many days/wk after school: Work in the ho~ dbl      108    
 82  ST295Q04JA How many days/wk after school: Work for pay    dbl      106    
 83  ST295Q05JA How many days/wk after school: Exercise or pr~ dbl      75     
 84  ST326Q01JA This school year, how many hours/day use [dig~ dbl      57     
 85  ST326Q02JA This school year, how many hours/day use [dig~ dbl      112    
 86  ST326Q03JA This school year, how many hours/day use [dig~ dbl      98     
 87  ST326Q04JA This school year, how many hours/day use [dig~ dbl      78     
 88  ST326Q05JA This school year, how many hours/day use [dig~ dbl      78     
 89  ST326Q06JA This school year, how many hours/day use [dig~ dbl      71     
 90  ST322Q01JA How often: I turn off notifications from soci~ dbl      1103   
 91  ST322Q02JA How often: I turn off notifications from soci~ dbl      1143   
 92  ST322Q03JA How often: I keep my [digital device] near me~ dbl      1156   
 93  ST322Q04JA How often:  I have my [digital device] open i~ dbl      1182   
 94  ST322Q06JA How often: I feel pressured to be online and ~ dbl      1212   
 95  ST322Q07JA How often:  I feel nervous/anxious when I don~ dbl      1111   
 96  ST263Q02JA Agree/disagree: Your intelligence is somethin~ dbl      63     
 97  ST263Q04JA Agree/disagree: Some people are just not good~ dbl      61     
 98  ST263Q06JA Agree/disagree: Some people are just not good~ dbl      63     
 99  ST059Q01TA Number of [class periods] per week in mathema~ dbl      109    
 100 ST059Q02JA Total number of [class periods] per week for ~ dbl      175    
 101 ST296Q01JA How much time spent on homework in: Mathemati~ dbl      70     
 102 ST296Q02JA How much time spent on homework in: [Test lan~ dbl      77     
 103 ST296Q03JA How much time spent on homework in: [Science]~ dbl      87     
 104 ST296Q04JA How much time spent on homework in: Total tim~ dbl      78     
 105 ST270Q01JA How often: The teacher shows an interest in e~ dbl      68     
 106 ST270Q02JA How often: The teacher gives extra help when ~ dbl      67     
 107 ST270Q03JA How often: The teacher helps students with th~ dbl      68     
 108 ST270Q04JA How often: The teacher continues teaching unt~ dbl      71     
 109 ST268Q01JA Agree/disagree: Mathematics is one of my favo~ dbl      69     
 110 ST268Q02JA Agree/disagree: [Test language] is one of my ~ dbl      74     
 111 ST268Q03JA Agree/disagree: [Science] is one of my favour~ dbl      79     
 112 ST268Q04JA Agree/disagree: Mathematics is easy for me.    dbl      73     
 113 ST268Q05JA Agree/disagree: [Test language] is easy for m~ dbl      71     
 114 ST268Q06JA Agree/disagree: [Science] is easy for me.      dbl      82     
 115 ST268Q07JA Agree/disagree: I want to do well in my mathe~ dbl      66     
 116 ST268Q08JA Agree/disagree: I want to do well in my [test~ dbl      71     
 117 ST268Q09JA Agree/disagree: I want to do well in my [scie~ dbl      65     
 118 ST292Q01JA Agree/disagree: I often worry that it will be~ dbl      1198   
 119 ST292Q02JA Agree/disagree: I get very tense when I have ~ dbl      1187   
 120 ST292Q03JA Agree/disagree: I get very nervous doing math~ dbl      1183   
 121 ST292Q04JA Agree/disagree: I feel helpless when doing a ~ dbl      1186   
 122 ST292Q05JA Agree/disagree: I worry that I will get poor ~ dbl      1158   
 123 ST292Q06JA Agree/disagree: I feel anxious about failing ~ dbl      1118   
 124 ST297Q01JA [Additional math instruction] received: One-o~ dbl      61     
 125 ST297Q03JA [Additional math instruction] received: Inter~ dbl      61     
 126 ST297Q05JA [Additional math instruction] received: Video~ dbl      61     
 127 ST297Q06JA [Additional math instruction] received: Small~ dbl      61     
 128 ST297Q07JA [Additional math instruction] received: Large~ dbl      61     
 129 ST297Q09JA [Additional math instruction] received: I do ~ dbl      61     
 130 ST327Q01JA Which of the following qualifications do you ~ dbl      223    
 131 ST327Q02JA Which of the following qualifications do you ~ dbl      193    
 132 ST327Q04JA Which of the following qualifications do you ~ dbl      265    
 133 ST327Q05JA Which of the following qualifications do you ~ dbl      410    
 134 ST327Q06JA Which of the following qualifications do you ~ dbl      226    
 135 ST327Q07JA Which of the following qualifications do you ~ dbl      404    
 136 ST327Q08JA Which of the following qualifications do you ~ dbl      593    
 137 ST330D10WA Have you done any of the following to find ou~ chr      0      
 138 ST331Q01JA How much effort did you put into doing well o~ dbl      134    
 139 ST331Q02JA How much effort would you have invested if yo~ dbl      126    
 140 ST331Q03JA How much effort did you put into giving accur~ dbl      125    
 141 IC170Q01JA How often use at school: Desktop or laptop co~ dbl      151    
 142 IC170Q02JA How often use at school: Smartphone (i.e. mob~ dbl      149    
 143 IC170Q03JA How often use at school: [Tablet device] (e.g~ dbl      137    
 144 IC170Q04JA How often use at school: Internet access (exc~ dbl      154    
 145 IC170Q05JA How often use at school: School portal (to co~ dbl      158    
 146 IC170Q06JA How often use at school: Educational software~ dbl      141    
 147 IC170Q07JA How often use at school: A learning managemen~ dbl      132    
 148 IC171Q01JA How often use out of school: Desktop or lapto~ dbl      151    
 149 IC171Q02JA How often use out of school: Smartphone (i.e.~ dbl      157    
 150 IC171Q03JA How often use out of school: Tablet device (e~ dbl      151    
 151 IC171Q04JA How often use out of school: Internet access ~ dbl      163    
 152 IC171Q05JA How often use out of school: Educational soft~ dbl      143    
 153 IC171Q06JA How often use out of school: Video or online ~ dbl      141    
 154 IC172Q01JA Agree/disagree: There are enough [digital res~ dbl      141    
 155 IC172Q02JA Agree/disagree: There are enough digital devi~ dbl      149    
 156 IC172Q03JA Agree/disagree: The school's Internet speed i~ dbl      143    
 157 IC172Q04JA Agree/disagree: [Digital resources] function ~ dbl      156    
 158 IC172Q05JA Agree/disagree: [Digital resources] are easil~ dbl      151    
 159 IC172Q06JA Agree/disagree: Digital learning resources av~ dbl      164    
 160 IC172Q07JA Agree/disagree: The school provides sufficien~ dbl      143    
 161 IC172Q08JA Agree/disagree: Teachers at my school have th~ dbl      147    
 162 IC172Q09JA Agree/disagree: Teachers at my school are wil~ dbl      147    
 163 IC173Q01JA How often use [digital resources] in lessons ~ dbl      142    
 164 IC173Q02JA How often use [digital resources] in lessons ~ dbl      150    
 165 IC173Q03JA How often use [digital resources] in lessons ~ dbl      155    
 166 IC173Q04JA How often use [digital resources] in lessons ~ dbl      142    
 167 IC174Q01JA How often used [digital resources] to: Create~ dbl      164    
 168 IC174Q02JA How often used [digital resources] to: Write ~ dbl      176    
 169 IC174Q03JA How often used [digital resources] to: Find i~ dbl      187    
 170 IC174Q04JA How often used [digital resources] to: Collec~ dbl      173    
 171 IC174Q05JA How often: used [digital resources] to: Analy~ dbl      179    
 172 IC174Q06JA How often used [digital resources] to: Report~ dbl      179    
 173 IC174Q07JA How often used [digital resources] to: Plan a~ dbl      184    
 174 IC174Q08JA How often used [digital resources] to: Track ~ dbl      185    
 175 IC174Q09JA How often used [digital resources] to: Collab~ dbl      176    
 176 IC174Q10JA How often used [digital resources] to: Play d~ dbl      169    
 177 IC175Q01JA How often used [digital resources] to: Read o~ dbl      162    
 178 IC175Q02JA How often used [digital resources] to: Read o~ dbl      170    
 179 IC175Q03JA How often used [digital resources] to: Read o~ dbl      166    
 180 IC175Q05JA How often used [digital resources] to: Work o~ dbl      167    
 181 IC176Q01JA How often used [digital resources] to: See my~ dbl      168    
 182 IC176Q02JA How often used [digital resources] to: Browse~ dbl      184    
 183 IC176Q03JA How often used [digital resources] to: Browse~ dbl      199    
 184 IC176Q04JA How often used [digital resources] to: Receiv~ dbl      176    
 185 IC176Q05JA How often used [digital resources] to: Upload~ dbl      178    
 186 IC176Q06JA How often used [digital resources] to: Commun~ dbl      173    
 187 IC176Q07JA How often used [digital resources] to: Commun~ dbl      175    
 188 IC176Q08JA How often used [digital resources] to: Search~ dbl      172    
 189 IC184Q01JA How often: I use [digital resources] for simp~ dbl      170    
 190 IC184Q02JA How often: I use [digital resources] to solve~ dbl      177    
 191 IC184Q03JA How often: I use [digital resources] for simu~ dbl      175    
 192 IC184Q04JA How often: I use [digital resources] for codi~ dbl      174    
 193 IC177Q01JA How much time spent: Play video-games (using ~ dbl      173    
 194 IC177Q02JA How much time spent: Browse social networks (~ dbl      199    
 195 IC177Q03JA How much time spent: Browse the Internet (exc~ dbl      207    
 196 IC177Q04JA How much time spent: Look for practical infor~ dbl      196    
 197 IC177Q05JA How much time spent: Communicate and share di~ dbl      183    
 198 IC177Q06JA How much time spent: Read, listen to or view ~ dbl      181    
 199 IC177Q07JA How much time spent: Create or edit my own di~ dbl      180    
 200 IC178Q01JA How much time using [digital resources] to: P~ dbl      206    
 201 IC178Q02JA How much time using [digital resources] to: B~ dbl      231    
 202 IC178Q03JA How much time using [digital resources] to: B~ dbl      226    
 203 IC178Q04JA How much time using [digital resources] to: L~ dbl      224    
 204 IC178Q05JA How much time using [digital resources] to: C~ dbl      207    
 205 IC178Q06JA How much time using [digital resources] to: R~ dbl      215    
 206 IC178Q07JA How much time using [digital resources] to: C~ dbl      211    
 207 IC179Q01JA Agree/disagree: Students should not be allowe~ dbl      190    
 208 IC179Q02JA Agree/disagree: Students should not be allowe~ dbl      202    
 209 IC179Q03JA Agree/disagree: Students should collaborate w~ dbl      198    
 210 IC179Q04JA Agree/disagree: The school should set up filt~ dbl      202    
 211 IC179Q05JA Agree/disagree: The school should set up filt~ dbl      195    
 212 IC179Q06JA Agree/disagree: Teachers should monitor what ~ dbl      192    
 213 IC180Q01JA Agree/disagree: I trust what I read online.    dbl      194    
 214 IC180Q02JA Agree/disagree: When searching for informatio~ dbl      216    
 215 IC180Q03JA Agree/disagree: I check the accuracy of onlin~ dbl      205    
 216 IC180Q04JA Agree/disagree: I discuss the accuracy of onl~ dbl      205    
 217 IC180Q05JA Agree/disagree: I discuss the accuracy of onl~ dbl      199    
 218 IC180Q06JA Agree/disagree: I discuss the accuracy of onl~ dbl      209    
 219 IC180Q07JA Agree/disagree: I try to flag wrong informati~ dbl      200    
 220 IC180Q08JA Agree/disagree: I share made-up information o~ dbl      203    
 221 IC182Q01JA Agree/disagree: I am interested in learning m~ dbl      190    
 222 IC182Q02JA Agree/disagree: I am interested in learning [~ dbl      188    
 223 IC182Q03JA Agree/disagree: I am interested in learning [~ dbl      190    
 224 IC183Q01JA Can do with [digital resources]: Search for a~ dbl      202    
 225 IC183Q02JA Can do with [digital resources]: Assess the q~ dbl      223    
 226 IC183Q03JA Can do with [digital resources]: Share practi~ dbl      221    
 227 IC183Q04JA Can do with [digital resources]: Collaborate ~ dbl      233    
 228 IC183Q05JA Can do with [digital resources]: Explain to o~ dbl      212    
 229 IC183Q07JA Can do with [digital resources]: Write or edi~ dbl      233    
 230 IC183Q08JA Can do with [digital resources]: Collect and ~ dbl      211    
 231 IC183Q09JA Can do with [digital resources]: Create a mul~ dbl      233    
 232 IC183Q10JA Can do with [digital resources]: Create, upda~ dbl      213    
 233 IC183Q12JA Can do with [digital resources]: Change the s~ dbl      226    
 234 IC183Q13JA Can do with [digital resources]: Select the m~ dbl      226    
 235 IC183Q14JA Can do with [digital resources]: Create a com~ dbl      210    
 236 IC183Q15JA Can do with [digital resources]: Identify the~ dbl      213    
 237 IC183Q16JA Can do with [digital resources]: Break down a~ dbl      207    
 238 OCOD1      ISCO-08 Occupation code - Mother               chr      0      
 239 OCOD2      ISCO-08 Occupation code - Father               chr      0      
 240 OCOD3      ISCO-08 Occupation code - Self                 chr      0      
 241 IMMIG      Index on immigrant background (OECD definitio~ dbl      236    
 242 COBN_S     Student's county of birth                      chr      0      
 243 COBN_M     Student mother's country of birth              chr      0      
 244 COBN_F     Student father's country of birth              chr      0      
 245 LANGN      Language spoken at home                        dbl      0      
 246 REPEAT     Grade repetition                               dbl      48     
 247 MISSSC     Missing school for more than 3 months          dbl      53     
 248 SKIPPING   Skipping classes or days of school             dbl      54     
 249 TARDYSD    Arriving late for school stricter definition   dbl      49     
 250 EXERPRAC   Exercise or practice a sport before or after ~ dbl      47     
 251 STUDYHMW   Studying for school or homework before or aft~ dbl      46     
 252 WORKPAY    Working for pay before or after school         dbl      51     
 253 WORKHOME   Working in household/take care of family memb~ dbl      51     
 254 EXPECEDU   Highest expected educational level             dbl      209    
 255 MATHPREF   Preference of Math over other core subjects    dbl      69     
 256 MATHEASE   Perception of Mathematics as easier than othe~ dbl      75     
 257 MATHMOT    Motivation to do well in mathematics           dbl      67     
 258 SISCO      Clear idea about future job                    dbl      259    
 259 MISCED     Mother’s level of education (ISCED)            dbl      74     
 260 FISCED     Father’s level of education (ISCED)            dbl      97     
 261 HISCED     Highest level of education of parents (ISCED)  dbl      57     
 262 ICTAVSCH   Availability and Usage of ICT at School        dbl      119    
 263 ICTAVHOM   Availability and Usage of ICT at Home          dbl      131    
 264 math       —                                              dbl      0      
 265 reading    —                                              dbl      0      
 266 science    —                                              dbl      0      
 values
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       </code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="data-health" class="level1">
<h1>Data Health</h1>
<section id="duplicates-check" class="level2">
<h2 class="anchored" data-anchor-id="duplicates-check">Duplicates Check</h2>
<p>Before moving on to the next step, let us check for duplicated records to prevent double counting of our results with the help of <code>group_by_all()</code> to detect if there are more than one instance of a row with the same details throughout all the columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#duplicate &lt;- stu_SG %&gt;% </span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co">#  group_by_all() %&gt;% </span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co">#  filter(n()&gt;1) %&gt;% </span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co">#  ungroup()</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co">#duplicate</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>